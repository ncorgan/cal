#
# Copyright (c) 2017 Nicholas Corgan (n.corgan@gmail.com)
#
# Distributed under the MIT License (MIT) (See accompanying file LICENSE.txt
# or copy at http://opensource.org/licenses/MIT)
#

INCLUDE_DIRECTORIES(
    ${CMAKE_SOURCE_DIR}/include
    ${CMAKE_CURRENT_SOURCE_DIR}
    ${CMAKE_CURRENT_SOURCE_DIR}/..
)

# Add small shared library to be loaded in dynload_test
ADD_LIBRARY(dynlib SHARED dynlib/dynlib.c)

MACRO(CAL_ADD_TEST name)
    ADD_EXECUTABLE(${name} ${name}.c)
    TARGET_LINK_LIBRARIES(${name} unity)
    IF(MSVC)
        TARGET_LINK_LIBRARIES(${name} shlwapi)
        ADD_TEST(
            ${name} ${CMAKE_CURRENT_BINARY_DIR}/${name}.exe
            WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}
        )
    ELSE()
        TARGET_LINK_LIBRARIES(${name} dl)
        ADD_TEST(
            ${name} ${CMAKE_CURRENT_BINARY_DIR}/${name}
            WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}
        )
    ENDIF()
ENDMACRO()

SET(cal_tests
    byteswap_test
    dynload_test
    fs_test
    process_test
    time_test
)

FOREACH(test ${cal_tests})
    CAL_ADD_TEST(${test})
ENDFOREACH()
